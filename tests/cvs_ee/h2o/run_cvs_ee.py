import niupy
import numpy as np

mo_spaces = {
    "FROZEN_DOCC": [1, 0, 0, 0],
    "RESTRICTED_DOCC": [1, 0, 0, 1],
    "ACTIVE": [2, 0, 1, 1],
}

eom_dsrg = niupy.EOM_DSRG(
    opt_einsum=True,
    mo_spaces=mo_spaces,
    nroots=10,
    max_cycle=200,
    max_space=200,
    tol_s=1e-10,
    tol_semi=1e-5,
    method_type="cvs_ee",
    diagonal_type="compute",
    first_row=False,
)

eom_dsrg.kernel()

# First_row False
# kernel_full
# ====================================================================================
#                                   EOM-DSRG summary
# -------------------------------------------------------------------------------------
# Root  Energy (eV)          f                    Symmetry   Spin
# -------------------------------------------------------------------------------------
# 1     540.2887714820       0.00000000           A1         Triplet
# 2     540.9660608351       0.01996767           A1         Singlet
# 3     542.4188308903       0.00000000           B2         Triplet
# 4     543.3395502334       0.04296089           B2         Singlet
# 5     558.8880576346       0.00000000           B1         Triplet
# 6     559.3784351366       0.00000000           A1         Triplet
# 7     560.8131483393       0.00000000           B1         Triplet
# 8     560.8544738583       0.10685804           B1         Singlet
# 9     561.2582005311       0.09234234           A1         Singlet
# 10    561.8845909106       0.00000000           B2         Triplet
# =====================================================================================

# kernel
# length of precond: 1614
# davidson 0 10  |r|= 1.16  e= [20.35176633 20.40320442 20.41395972 20.44805927 20.776288   20.87126389
#  20.97300932 21.05195854 21.1473529  21.15877833]  max|de|= 21.2  lindep=    1
# Old state -> New state
#     6     ->     5
#     5     ->     6
# davidson 1 20  |r|= 0.321  e= [19.88034902 19.9122112  19.96949628 20.00072999 20.54795555 20.59245633
#  20.61967327 20.66293311 20.67627208 20.68032636]  max|de|= -0.491  lindep= 0.99
# davidson 2 30  |r|= 0.109  e= [19.85824418 19.88443156 19.93658189 19.97093441 20.54078915 20.57179974
#  20.61270401 20.63910384 20.65336125 20.65648142]  max|de|= -0.0329  lindep= 0.992
# davidson 3 40  |r|= 0.0733  e= [19.85569858 19.88072176 19.93391991 19.96771767 20.5398812  20.56416923
#  20.61188021 20.63148277 20.65037717 20.65292552]  max|de|= -0.00763  lindep= 0.974
# davidson 4 50  |r|= 0.0557  e= [19.8553122  19.88021517 19.93358736 19.967401   20.53958986 20.55991404
#  20.61158994 20.62850377 20.64954284 20.65144971]  max|de|= -0.00426  lindep= 0.98
# davidson 5 60  |r|= 0.0344  e= [19.8552535  19.88014465 19.93353599 19.96736774 20.53932308 20.55795479
#  20.6113605  20.62709399 20.64920123 20.65069534]  max|de|= -0.00196  lindep= 0.982
# davidson 6 70  |r|= 0.0266  e= [19.85524697 19.88013693 19.93352553 19.96736117 20.53909705 20.55721712
#  20.61119751 20.62632222 20.64900023 20.65030437]  max|de|= -0.000772  lindep= 0.983
# Old state -> New state
#     4     ->     8
#     8     ->     9
# davidson 7 80  |r|= 0.186  e= [19.85524627 19.88013618 19.93352449 19.96736028 20.53893495 20.55695605
#  20.61111219 20.6260036  20.64351055 20.64893772]  max|de|= 20.6  lindep= 0.98
# Old state -> New state
#     8     ->     7
#     7     ->     8
# davidson 8 90  |r|= 0.117  e= [19.85524615 19.88013607 19.93352438 19.96736019 20.53883707 20.55684798
#  20.61105987 20.62379436 20.62589576 20.64890623]  max|de|= -0.0197  lindep= 0.977
# davidson 9 100  |r|= 0.0758  e= [19.85524613 19.88013606 19.93352437 19.96736018 20.5387903  20.55679999
#  20.6110346  20.61572212 20.62586925 20.64888497]  max|de|= -0.00807  lindep= 0.986
# davidson 10 110  |r|= 0.0527  e= [19.85524613 19.88013606 19.93352437 19.96736018 20.53876507 20.55678315
#  20.61102471 20.6111157  20.62586109 20.64887947]  max|de|= -0.00461  lindep= 0.984
# Old state -> New state
#     7     ->     6
#     6     ->     7
# root 0 converged  |r|= 6.82e-06  e= 19.855246131047224  max|de|= -1.64e-10
# root 1 converged  |r|= 7.7e-06  e= 19.880136055679504  max|de|= -1.76e-10
# root 2 converged  |r|= 6.72e-06  e= 19.93352437077464  max|de|= -1.27e-10
# root 3 converged  |r|= 5.47e-06  e= 19.967360182559265  max|de|= -9.44e-11
# davidson 11 120  |r|= 0.0205  e= [19.85524613 19.88013606 19.93352437 19.96736018 20.53875825 20.55677927
#  20.60972255 20.61102215 20.62585902 20.64887822]  max|de|= -0.00139  lindep= 0.988
# davidson 12 126  |r|= 0.00675  e= [19.85524613 19.88013606 19.93352437 19.96736018 20.53875739 20.55677856
#  20.60952806 20.61102179 20.62585856 20.64887795]  max|de|= -0.000194  lindep= 0.988
# davidson 13 132  |r|= 0.00254  e= [19.85524613 19.88013606 19.93352437 19.96736018 20.53875731 20.55677838
#  20.60950737 20.61102176 20.62585846 20.64887788]  max|de|= -2.07e-05  lindep= 0.975
# davidson 14 138  |r|= 0.00109  e= [19.85524613 19.88013606 19.93352437 19.96736018 20.5387573  20.55677835
#  20.60950417 20.61102176 20.62585844 20.64887786]  max|de|= -3.2e-06  lindep= 0.975
# davidson 15 144  |r|= 0.000425  e= [19.85524613 19.88013606 19.93352437 19.96736018 20.53875729 20.55677834
#  20.60950372 20.61102176 20.62585844 20.64887786]  max|de|= -4.53e-07  lindep= 0.983
# davidson 16 150  |r|= 0.000174  e= [19.85524613 19.88013606 19.93352437 19.96736018 20.53875729 20.55677833
#  20.60950363 20.61102176 20.62585844 20.64887786]  max|de|= -8.59e-08  lindep= 0.971
# root 4 converged  |r|= 9.79e-06  e= 20.538757294128562  max|de|= -1.5e-10
# davidson 17 156  |r|= 0.000168  e= [19.85524613 19.88013606 19.93352437 19.96736018 20.53875729 20.55677833
#  20.60950361 20.61102176 20.62585844 20.64887786]  max|de|= -2.72e-08  lindep= 0.978
# root 7 converged  |r|= 7.41e-06  e= 20.61102175543361  max|de|= -1.02e-10
# davidson 18 161  |r|= 0.000157  e= [19.85524613 19.88013606 19.93352437 19.96736018 20.53875729 20.55677833
#  20.60950358 20.61102176 20.62585844 20.64887786]  max|de|= -2.77e-08  lindep= 0.967
# root 5 converged  |r|= 8.89e-06  e= 20.556778331248406  max|de|= -1.65e-10
# root 9 converged  |r|= 5.93e-06  e= 20.648877857115554  max|de|= -7.06e-11
# davidson 19 165  |r|= 6.26e-05  e= [19.85524613 19.88013606 19.93352437 19.96736018 20.53875729 20.55677833
#  20.60950357 20.61102176 20.62585844 20.64887786]  max|de|= -1.05e-08  lindep= 0.979
# root 8 converged  |r|= 6.69e-06  e= 20.625858435493033  max|de|= -5.61e-11
# davidson 20 167  |r|= 2.66e-05  e= [19.85524613 19.88013606 19.93352437 19.96736018 20.53875729 20.55677833
#  20.60950357 20.61102176 20.62585844 20.64887786]  max|de|= -1.62e-09  lindep= 0.981
# davidson 21 168  |r|= 1.38e-05  e= [19.85524613 19.88013606 19.93352437 19.96736018 20.53875729 20.55677833
#  20.60950357 20.61102176 20.62585844 20.64887786]  max|de|= -3.42e-10  lindep= 0.982
# root 6 converged  |r|= 7.5e-06  e= 20.609503566831616  max|de|= -9.64e-11
# converged 22 169  |r|= 8.51e-06  e= [19.85524613 19.88013606 19.93352437 19.96736018 20.53875729 20.55677833
#  20.60950357 20.61102176 20.62585844 20.64887786]  max|de|= -9.64e-11
# All EOM-DSRG roots converged.
# Root 0: [(np.float64(4.409875779095504), (np.int64(0), np.int64(1), np.int64(2), np.int64(3)), 'iAaV'), (np.float64(-4.409869662328254), (np.int64(1), np.int64(0), np.int64(3), np.int64(2)), 'aIvA'), (np.float64(-3.871804608607946), (np.int64(1), np.int64(0), np.int64(2), np.int64(3)), 'aIaV')]
# Root 1: [(np.float64(-4.890119380648273), (np.int64(0), np.int64(1), np.int64(2), np.int64(3)), 'iAaV'), (np.float64(-4.890071508700147), (np.int64(1), np.int64(0), np.int64(3), np.int64(2)), 'aIvA'), (np.float64(-4.377694008596716), (np.int64(1), np.int64(0), np.int64(2), np.int64(3)), 'aIaV')]
# Root 2: [(np.float64(-23.40218025193149), (np.int64(0), np.int64(3), np.int64(2), np.int64(3)), 'iAaV'), (np.float64(23.402087452858435), (np.int64(3), np.int64(0), np.int64(3), np.int64(2)), 'aIvA'), (np.float64(20.86298876290724), (np.int64(3), np.int64(0), np.int64(2), np.int64(3)), 'aIaV')]
# Root 3: [(np.float64(-22.335251184127856), (np.int64(3), np.int64(0), np.int64(3), np.int64(2)), 'aIvA'), (np.float64(-22.335168010974492), (np.int64(0), np.int64(3), np.int64(2), np.int64(3)), 'iAaV'), (np.float64(-19.618195304538258), (np.int64(0), np.int64(3), np.int64(3), np.int64(2)), 'iAvA')]
# Root 4: [(np.float64(14.447125111761805), (np.int64(0), np.int64(2)), 'IA'), (np.float64(-14.447082568506554), (np.int64(0), np.int64(2)), 'ia'), (np.float64(3.906120695627534), (np.int64(0), np.int64(1), np.int64(3), np.int64(0)), 'iava')]
# Root 5: [(np.float64(3.98696383525925), (np.int64(1), np.int64(0), np.int64(3), np.int64(2)), 'aIvA'), (np.float64(-3.9868942841021764), (np.int64(0), np.int64(1), np.int64(2), np.int64(3)), 'iAaV'), (np.float64(-3.675016977633511), (np.int64(0), np.int64(1), np.int64(3), np.int64(2)), 'iAvA')]
# Root 6: [(np.float64(151.0816812169115), (np.int64(0), np.int64(2)), 'IA'), (np.float64(-151.08068894885176), (np.int64(0), np.int64(2)), 'ia'), (np.float64(-54.076092837584575), (np.int64(0), np.int64(3), np.int64(4), np.int64(2)), 'IAVA')]
# Root 7: [(np.float64(-10.141864193639382), (np.int64(0), np.int64(2)), 'IA'), (np.float64(-10.141344393565408), (np.int64(0), np.int64(2)), 'ia'), (np.float64(2.0650133186034685), (np.int64(1), np.int64(0), np.int64(0), np.int64(3)), 'aIaV')]
# Root 8: [(np.float64(4.903054823249818), (np.int64(0), np.int64(1), np.int64(2), np.int64(3)), 'iAaV'), (np.float64(4.902993385358415), (np.int64(1), np.int64(0), np.int64(3), np.int64(2)), 'aIvA'), (np.float64(4.864741670194438), (np.int64(0), np.int64(0), np.int64(3), np.int64(2)), 'aIvA')]
# Root 9: [(np.float64(-46.15879210938428), (np.int64(3), np.int64(0), np.int64(3), np.int64(2)), 'aIvA'), (np.float64(46.15816289263397), (np.int64(0), np.int64(3), np.int64(2), np.int64(3)), 'iAaV'), (np.float64(-39.50209899940731), (np.int64(3), np.int64(0), np.int64(2), np.int64(3)), 'aIaV')]
# =====================================================================================
#                                   EOM-DSRG summary
# -------------------------------------------------------------------------------------
# Root  Energy (eV)          f                    Symmetry   Spin
# -------------------------------------------------------------------------------------
# 1     540.2887714806       0.00000000           A1         Triplet
# 2     540.9660608333       0.01991209           A1         Singlet
# 3     542.4188308968       0.00000000           B2         Triplet
# 4     543.3395502402       0.04335802           B2         Singlet
# 5     558.8880577406       0.00000000           B1         Triplet
# 6     559.3784351445       0.00000000           A1         Triplet
# 7     560.8131618950       0.00000000           B1         Triplet
# 8     560.8544739110       0.10753767           B1         Singlet
# 9     561.2582005431       0.09303368           A1         Singlet
# 10    561.8845909159       0.00000000           B2         Triplet
# =====================================================================================
