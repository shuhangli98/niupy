import niupy
import numpy as np

mo_spaces = {
    "FROZEN_DOCC": [1, 0, 0, 0],
    "RESTRICTED_DOCC": [1, 0, 0, 1],
    "ACTIVE": [2, 0, 1, 1],
}

eom_dsrg = niupy.EOM_DSRG(
    opt_einsum=True,
    mo_spaces=mo_spaces,
    nroots=10,
    max_cycle=200,
    max_space=200,
    tol_s=1e-10,
    tol_semi=1e-10,
    method_type="cvs_ip",
    diagonal_type="compute",
)

eom_dsrg.kernel()

# Old Kernel full (commit: d63e3b6)
# =====================================================================================
#                                   EOM-DSRG summary
# -------------------------------------------------------------------------------------
# Root  Energy (eV)          P                    Symmetry   Spin
# -------------------------------------------------------------------------------------
# 1     545.9415248560       1.61761416           A1         Doublet
# 2     571.7665663113       0.00000000           B1         Quartet
# 3     572.0315519854       0.00000000           A2         Quartet
# 4     572.2423427207       0.00000000           B2         Quartet
# 5     573.1372280108       0.00000000           B1         Quartet
# 6     574.1792207562       0.00000000           A2         Doublet
# 7     574.2708362695       0.00000000           A1         Quartet
# 8     574.4478900263       0.00000000           B1         Quartet
# 9     574.5615314965       0.01134412           A1         Doublet
# 10    574.9812037549       0.00000000           B2         Quartet
# =====================================================================================

# Kernel full
# =====================================================================================
#                                   EOM-DSRG summary
# -------------------------------------------------------------------------------------
# Root  Energy (eV)          P                    Symmetry   Spin
# -------------------------------------------------------------------------------------
# 1     545.9415248558       1.61761416           A1         Doublet
# 2     571.7665663115       0.00000000           B1         Quartet
# 3     572.0315519878       0.00000000           A2         Doublet
# 4     572.2423427207       0.00000000           B2         Quartet
# 5     573.1372280105       0.00000000           B1         Quartet
# 6     574.1792207526       0.00000000           A2         Doublet
# 7     574.2708362694       0.00000000           A1         Quartet
# 8     574.4478900267       0.00000000           B1         Quartet
# 9     574.5615314963       0.01134412           A1         Doublet
# 10    574.9812037549       0.00000000           B2         Quartet
# =====================================================================================

# Kernel
# davidson 0 10  |r|= 0.942  e= [20.42114424 21.19390402 21.29383962 21.33986313 21.33987865 21.43827212
#  21.48924842 21.55996618 21.72254882 21.80978622]  max|de|= 21.8  lindep=    1
# Old state -> New state
#     4     ->     3
#     7     ->     4
#     3     ->     5
#     9     ->     7
#     5     ->     8
#     8     ->     9
# davidson 1 20  |r|= 0.498  e= [20.07761979 21.02707325 21.08146357 21.12716473 21.14118532 21.15076929
#  21.258344   21.31766033 21.38833032 21.50859675]  max|de|= -0.492  lindep= 0.974
# Old state -> New state
#     4     ->     3
#     7     ->     4
#     3     ->     5
#     5     ->     6
#     6     ->     7
# davidson 2 30  |r|= 0.297  e= [20.06381191 21.01391495 21.06423215 21.07696615 21.10886814 21.11247717
#  21.11438191 21.21255492 21.3605353  21.47890147]  max|de|= -0.209  lindep= 0.941
# Old state -> New state
#     6     ->     5
#     5     ->     6
#     9     ->     8
#     8     ->     9
# davidson 3 40  |r|=  0.6  e= [20.06302026 21.01224565 21.06260111 21.06485144 21.09510617 21.10541349
#  21.1107697  21.20198771 21.30176154 21.35612368]  max|de|= 21.3  lindep= 0.797
# Old state -> New state
#     3     ->     2
#     2     ->     3
#     3     ->     7
#     7     ->     9
# davidson 4 50  |r|= 0.386  e= [20.06298197 21.01205757 21.02934207 21.06241518 21.07031992 21.10418047
#  21.1105843  21.12142851 21.15114476 21.20708365]  max|de|= -0.151  lindep= 0.896
# Old state -> New state
#     4     ->     3
#     3     ->     4
#     4     ->     9
# davidson 5 60  |r|= 0.15  e= [20.06298101 21.01203927 21.02504268 21.03700294 21.06240559 21.10406795
#  21.11057258 21.11614862 21.1208562  21.16692448]  max|de|= 21.2  lindep= 0.875
# davidson 6 70  |r|= 0.0499  e= [20.06298099 21.01203473 21.02333694 21.03020115 21.06240476 21.10406425
#  21.11057093 21.11259701 21.11561782 21.15644251]  max|de|= -0.0105  lindep= 0.891
# Old state -> New state
#     7     ->     5
#     5     ->     6
#     6     ->     7
#     7     ->     9
# root 0 converged  |r|= 5.1e-06  e= 20.062980986009933  max|de|= -4.16e-10
# davidson 7 80  |r|= 0.0503  e= [20.06298099 21.01203387 21.02185937 21.02973153 21.06240465 21.10197342
#  21.104064   21.11057065 21.11484189 21.14417839]  max|de|= 21.1  lindep= 0.798
# davidson 8 89  |r|= 0.00736  e= [20.06298099 21.01203382 21.02177239 21.02964724 21.06240464 21.100707
#  21.10406398 21.11057063 21.11475045 21.14143536]  max|de|= -0.00274  lindep= 0.776
# davidson 9 98  |r|= 0.00694  e= [20.06298099 21.01203377 21.0217718  21.02954346 21.06240464 21.10069719
#  21.10406398 21.11057061 21.11474705 21.14141501]  max|de|= -0.000104  lindep= 0.778
# root 2 converged  |r|= 1.96e-07  e= 21.02177179849818  max|de|= -9.08e-10
# root 4 converged  |r|= 2.2e-06  e= 21.062404643024568  max|de|= -5.61e-11
# root 6 converged  |r|= 6.75e-06  e= 21.10406397816262  max|de|= -2.9e-10
# davidson 10 107  |r|= 0.0271  e= [20.06298099 21.01203375 21.0217718  21.02951847 21.06240464 21.10069717
#  21.10406398 21.11057058 21.11474684 21.13047841]  max|de|= 21.1  lindep= 0.812
# root 1 converged  |r|= 3.38e-06  e= 21.012033754649277  max|de|= -1.42e-10
# root 5 converged  |r|= 2.22e-11  e= 21.10069716990459  max|de|= -6.62e-12
# root 7 converged  |r|= 7.98e-06  e= 21.11057058374346  max|de|= -6.89e-10
# davidson 11 113  |r|= 0.00549  e= [20.06298099 21.01203375 21.0217718  21.02951823 21.06240464 21.10069717
#  21.10406398 21.11057058 21.11474683 21.13018767]  max|de|= -0.000291  lindep= 0.855
# root 8 converged  |r|= 5.29e-06  e= 21.11474683071082  max|de|= -2.19e-10
# davidson 12 116  |r|= 0.00272  e= [20.06298099 21.01203375 21.0217718  21.02951822 21.06240464 21.10069717
#  21.10406398 21.11057058 21.11474683 21.13017166]  max|de|= -1.6e-05  lindep= 0.866
# davidson 13 118  |r|= 0.000753  e= [20.06298099 21.01203375 21.0217718  21.02951822 21.06240464 21.10069717
#  21.10406398 21.11057058 21.11474683 21.13016977]  max|de|= -1.89e-06  lindep= 0.846
# root 3 converged  |r|= 2.79e-06  e= 21.02951821519992  max|de|= -6.46e-11
# davidson 14 120  |r|= 0.000196  e= [20.06298099 21.01203375 21.0217718  21.02951822 21.06240464 21.10069717
#  21.10406398 21.11057058 21.11474683 21.13016953]  max|de|= -2.41e-07  lindep= 0.902
# davidson 15 121  |r|= 6.37e-05  e= [20.06298099 21.01203375 21.0217718  21.02951822 21.06240464 21.10069717
#  21.10406398 21.11057058 21.11474683 21.1301695 ]  max|de|= -2.4e-08  lindep= 0.897
# root 9 converged  |r|= 8.65e-06  e= 21.130169501802058  max|de|= -1.9e-09
# converged 16 122  |r|= 8.65e-06  e= [20.06298099 21.01203375 21.0217718  21.02951822 21.06240464 21.10069717
#  21.10406398 21.11057058 21.11474683 21.1301695 ]  max|de|= -1.9e-09
# All EOM-DSRG roots converged.
# Root 0: [(np.float64(-1.4303435335300525), (np.int64(0), np.int64(1), np.int64(0)), 'IAA'), (np.float64(1.427409669009412), (np.int64(1), np.int64(0), np.int64(0)), 'aIa'), (np.float64(0.8993370307473465), (np.int64(0),), 'I')]
# Root 1: [(np.float64(26.223339646912027), (np.int64(0), np.int64(1), np.int64(2)), 'IAA'), (np.float64(-26.22330648921974), (np.int64(0), np.int64(1), np.int64(2)), 'iAa'), (np.float64(26.223151557245362), (np.int64(1), np.int64(0), np.int64(2)), 'aIa')]
# Root 2: [(np.float64(167.55544204952963), (np.int64(0), np.int64(3), np.int64(2)), 'IAA'), (np.float64(-167.55544165396114), (np.int64(0), np.int64(3), np.int64(2)), 'iAa'), (np.float64(167.55544163056413), (np.int64(3), np.int64(0), np.int64(2)), 'aIa')]
# Root 3: [(np.float64(12.48574484120329), (np.int64(3), np.int64(0), np.int64(0)), 'aIa'), (np.float64(12.48545661423316), (np.int64(0), np.int64(3), np.int64(0)), 'IAA'), (np.float64(-12.485176689259983), (np.int64(0), np.int64(3), np.int64(0)), 'iAa')]
# Root 4: [(np.float64(40.619431276205354), (np.int64(1), np.int64(0), np.int64(2)), 'aIa'), (np.float64(39.115003693999164), (np.int64(0), np.int64(0), np.int64(2)), 'aIa'), (np.float64(-21.649856258207734), (np.int64(0), np.int64(1), np.int64(2)), 'IAA')]
# Root 5: [(np.float64(211.13830257248782), (np.int64(0), np.int64(3), np.int64(2)), 'IAA'), (np.float64(-210.72333695669593), (np.int64(3), np.int64(0), np.int64(2)), 'aIa'), (np.float64(-1.8597933510430718), (np.int64(1), np.int64(0), np.int64(2)), 'cIa')]
# Root 6: [(np.float64(1.6231140634970447), (np.int64(0), np.int64(1), np.int64(0)), 'iAv'), (np.float64(-1.6231105946053506), (np.int64(1), np.int64(0), np.int64(0)), 'aIv'), (np.float64(-1.6231026803941742), (np.int64(0), np.int64(1), np.int64(0)), 'IAV')]
# Root 7: [(np.float64(34.971129758055575), (np.int64(0), np.int64(1), np.int64(2)), 'iAa'), (np.float64(31.472716090814668), (np.int64(0), np.int64(1), np.int64(2)), 'IAA'), (np.float64(31.250547470147968), (np.int64(0), np.int64(0), np.int64(2)), 'iAa')]
# Root 8: [(np.float64(-4.197183399783549), (np.int64(0), np.int64(1), np.int64(0)), 'IAA'), (np.float64(4.148062523598873), (np.int64(1), np.int64(0), np.int64(0)), 'aIa'), (np.float64(1.9276928018568753), (np.int64(0), np.int64(1), np.int64(0)), 'IAV')]
# Root 9: [(np.float64(15.70640910126985), (np.int64(3), np.int64(0), np.int64(0)), 'aIa'), (np.float64(-10.718129938164397), (np.int64(0), np.int64(3), np.int64(0)), 'IAA'), (np.float64(-10.119272239024106), (np.int64(3), np.int64(0), np.int64(1)), 'aIa')]
# =====================================================================================
#                                   EOM-DSRG summary
# -------------------------------------------------------------------------------------
# Root  Energy (eV)          P                    Symmetry   Spin
# -------------------------------------------------------------------------------------
# 1     545.9415248559       1.61761419           A1         Doublet
# 2     571.7665663112       0.00000000           B1         Quartet
# 3     572.0315519838       0.00000000           A2         Doublet
# 4     572.2423427206       0.00000000           B2         Quartet
# 5     573.1372280104       0.00000000           B1         Quartet
# 6     574.1792207498       0.00000000           A2         Doublet
# 7     574.2708362696       0.00000000           A1         Doublet
# 8     574.4478900262       0.00000000           B1         Quartet
# 9     574.5615314966       0.01134412           A1         Doublet
# 10    574.9812037566       0.00000000           B2         Quartet
# =====================================================================================
